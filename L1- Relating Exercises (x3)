##Moneyball exercises 1-12

(12) SELECT "first_name", "last_name"
     FROM
          (SELECT "first_name", "last_name", "id"
           FROM
               (SELECT "first_name", "last_name", "players"."id" FROM "performances"
               JOIN "players" ON "players"."id" = "performances"."player_id"
               JOIN "salaries" ON "salaries"."player_id" = "players"."id" AND "performances"."year" = "salaries"."year"
               WHERE "performances"."year" = 2001 AND "H" > 0
               ORDER BY "salary" / "H"
               LIMIT 10
               )

          INTERSECT

          SELECT "first_name", "last_name", "id"
          FROM
               (SELECT "first_name", "last_name", "players"."id" FROM "performances"
               JOIN "players" ON "players"."id" = "performances"."player_id"
               JOIN "salaries" ON "salaries"."player_id" = "players"."id" AND "performances"."year" = "salaries"."year"
               WHERE "performances"."year" = 2001 AND "RBI" > 0
               ORDER BY "salary" / "RBI"
               LIMIT 10
               )
          )
     ORDER BY "id";


(11) SELECT "first_name", "last_name", ("salary" / "H") AS "dollars per hit"
     FROM "players"
     JOIN "performances" ON "players"."id" = "performances"."player_id"
     JOIN "salaries" ON "performances"."player_id" = "salaries"."player_id" AND "performances"."year" = "salaries"."year"
         WHERE "performances"."year" = 2001 AND "H" != 0
         ORDER BY "dollars per hit", "first_name", "last_name"
         LIMIT 10;

(10) SELECT "first_name", "last_name", "salary", "HR", "salaries"."year"
     FROM "players"
     JOIN "performances" ON "performances"."player_id" = "players"."id"
     JOIN "salaries" ON "salaries"."player_id" = "performances"."player_id" AND "performances"."year" = "salaries"."year"
        ORDER BY "players"."id", "salaries"."year" DESC, "HR" DESC, "salary" DESC;

(9) SELECT "names", ROUND(AVG(salary), 2) AS "average salary"
    FROM "salaries"
    JOIN "teams" ON "teams"."id" = "salaries"."team_id"
        WHERE "salaries"."year" = 2001
        GROUP BY "team_id"
        ORDER BY AVG(salary)
        LIMIT 5;

(8) SELECT "salary" FROM "salaries"
    WHERE "year" = 2001
    AND "player_id" =
        (SELECT "player_id" FROM "performances" WHERE "HR" =
            (SELECT MAX(HR) FROM "performances"));

(7) SELECT "first_name", "last_name"
    FROM "players"
    WHERE "id" = (SELECT "player_id" FROM "salaries" WHERE "salary" = (SELECT MAX(salary) FROM "salaries"));

(6) SELECT "name", SUM(H) AS "total hits"
     FROM "performances"
     JOIN "teams" ON "performances"."team_id" = "teams"."id"
        WHERE "performances"."year" = 2001
        GROUP BY "team_id"
        ORDER BY SUM(H) DESC
        LIMIT 5;

(5)SELECT "name" FROM "teams" WHERE "id" IN
    (SELECT "team_id" FROM "performances" WHERE "player_id" =
        (SELECT "id" FROM "players" WHERE "first_name" = 'Satchel' AND "last_name" = 'Paige'));

(4) SELECT "first_name", "last_name", "salary"
    FROM (SELECT "id", "first_name", "last_name" FROM "players") AS minplayers
    JOIN "salaries" ON "minplayers"."id" = "salaries"."player_id"
    WHERE "year" = '2001'
    ORDER BY "salary", "first_name", "last_name", "player_ID"
    LIMIT 50;

(3) SELECT "year", "HR" AS "home runs"
    FROM "performances"
    WHERE "player_id" = (SELECT "id" FROM "players" WHERE "first_name" = 'Ken' AND "last_name" = 'Griffey' AND "birth_year" = 1969)
    ORDER BY "year" DESC;

(2) SELECT "year", "salary"
    FROM "salaries"
    WHERE "player_id" = (SELECT "id" FROM "players" WHERE "first_name" = 'Cal' AND "last_name" = 'Ripken')
    ORDER BY "year" DESC;

(1) SELECT "year", ROUND(AVG(salary), 2) AS "average salary" 
    FROM "salaries"
    GROUP BY "year" ORDER BY "year" DESC;



##Department of Elementary and Secondary Education exercises 1-13

(13) SELECT "district_id", "per_pupil_expenditure", "pupils", "exemplary", "unsatisfactory"
     FROM "expenditures"
     NATURAL JOIN "staff_evaluations"
      ORDER BY "per_pupil_expenditure" DESC, "exemplary" DESC
      LIMIT 20;

(12) SELECT "name", "per_pupil_expenditure", "exemplary"
     FROM "districts"
     JOIN "expenditures" ON "districts"."id" = "expenditures"."district_id"
     JOIN "staff_evaluations" ON "expenditures"."district_id" = "staff_evaluations"."district_id"
       WHERE "type" = 'Public School District' 
       AND "per_pupil_expenditure" > (SELECT AVG(per_pupil_expenditure) FROM "expenditures")
       AND "exemplary" > (SELECT AVG(exemplary) FROM "staff_evaluations")
       ORDER BY "exemplary" DESC, "per_pupil_expenditure" DESC;

(11) SELECT "name", "per_pupil_expenditure", "graduated" 
     FROM "expenditures" 
     JOIN "schools" ON "expenditures"."district_id" = "schools"."district_id" 
     JOIN "graduation_rates" ON "schools"."id" = "graduation_rates"."school_id" 
      ORDER BY "per_pupil_expenditure" DESC, "name";

(10) SELECT "name", "per_pupil_expenditure"
     FROM "districts"
     JOIN "expenditures" ON "districts"."id" = "expenditures"."district_id"
      WHERE "type" = 'Public School District'
      ORDER BY "per_pupil_expenditure" DESC
      LIMIT 10;

(9) SELECT "districts"."name" 
    FROM "districts" 
    JOIN "expenditures" ON "districts"."id" = "expenditures"."district_id" 
    ORDER BY "expenditures"."pupils" 
    LIMIT 1;

(8) SELECT "districts"."name", "expenditures"."pupils"
    FROM "districts"
    JOIN "expenditures" ON "districts"."id" = "expenditures"."district_id";

(7) SELECT "name" FROM "schools" WHERE "district_id" = (SELECT "id" FROM "districts" WHERE "name" = 'Cambridge');

(6) SELECT "name" FROM "schools" WHERE "id" IN (SELECT "school_id" FROM "graduation_rates" WHERE "graduated" = 100);

(5) SELECT "city", COUNT(name) FROM "schools" WHERE "type" = 'Public School' 
    GROUP BY "city" HAVING COUNT(name) <= 3 
    ORDER BY COUNT(name) DESC, "city";

(4) SELECT "city", COUNT(name) FROM "schools" WHERE "type" = 'Public School' 
    GROUP BY "city" 
    ORDER BY COUNT(name) DESC, "city" 
    LIMIT 10;

(3) SELECT AVG("per_pupil_expenditure") AS "Average District Per-Pupil Expenditure" FROM "expenditures";

(2) SELECT "name" FROM "districts" WHERE "name" LIKE "%non-op%";

(1) SELECT "name", "city" FROM "schools" WHERE "type" = 'Public School' AND "state" = 'MA';
